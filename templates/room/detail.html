<!DOCTYPE html>
<html>
    <head>
        <!-- ... -->
    </head>
    <body>
        <!-- ... -->
        <h2>{{ room.name }}</h2>
        <p>Room Code: {{ room.code }}</p>
        <h3>Connected Users:</h3>

<ul id="userList"></ul>


<form action="/leave" method="post">
    <input type="hidden" name="room_id" value="{{ room.id }}">
    <input type="submit" value="Leave Room">
</form>

<script src="https://cdn.socket.io/4.4.1/socket.io.js"></script>
<script>
    var socket = io()
    // Event handler for successful connection
    socket.on('connect', function() {
        console.log('Connected to server.');
    });

        // Join a room
        console.log('Joining room:', '{{ room.id }}');  // Add this line for debugging
        socket.emit('join_room', {
            room_id: '{{ room.id }}'  // Room ID is obtained from the server-side Flask variable
        });
        
    // Event handler for disconnection
    socket.on('disconnect', function() {
        console.log('Disconnected from server.');
    });

    // Event handler for updates to the list of connected users
    socket.on('connected_users_update', function(data) {
        console.log('Received connected_users_update event:', data);  // Added for debugging
    
        console.log('Updated list of connected users:', data.users);
    
        // Update the user list in the HTML
        var userList = document.getElementById('userList');
        userList.innerHTML = '';
        for (var i = 0; i < data.users.length; i++) {
            console.log('Adding user to list:', data.users[i]);  // Added for debugging
            var li = document.createElement('li');
            li.textContent = data.users[i];
            userList.appendChild(li);
        }
    });

    // Event handler for errors
    socket.on('error', function(data) {
        console.log('Error:', data.message);
    });
</script>

</body>
</html>
